<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.42">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>LASSO Regressions Quarto</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="LASSO Regressions Quarto_files/libs/clipboard/clipboard.min.js"></script>
<script src="LASSO Regressions Quarto_files/libs/quarto-html/quarto.js"></script>
<script src="LASSO Regressions Quarto_files/libs/quarto-html/popper.min.js"></script>
<script src="LASSO Regressions Quarto_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="LASSO Regressions Quarto_files/libs/quarto-html/anchor.min.js"></script>
<link href="LASSO Regressions Quarto_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="LASSO Regressions Quarto_files/libs/quarto-html/quarto-syntax-highlighting-2f5df379a58b258e96c21c0638c20c03.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="LASSO Regressions Quarto_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="LASSO Regressions Quarto_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="LASSO Regressions Quarto_files/libs/bootstrap/bootstrap-91896bc46ced86c13ca94e5e703bccca.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script src="LASSO Regressions Quarto_files/libs/kePrint-0.0.1/kePrint.js"></script>
<link href="LASSO Regressions Quarto_files/libs/lightable-0.0.1/lightable.css" rel="stylesheet">
<link href="LASSO Regressions Quarto_files/libs/pagedtable-1.1/css/pagedtable.css" rel="stylesheet">
<script src="LASSO Regressions Quarto_files/libs/pagedtable-1.1/js/pagedtable.js"></script>


</head>

<body>

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
  <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#packages" id="toc-packages" class="nav-link active" data-scroll-target="#packages">Packages</a></li>
  <li><a href="#data" id="toc-data" class="nav-link" data-scroll-target="#data">Data</a></li>
  <li><a href="#regressions" id="toc-regressions" class="nav-link" data-scroll-target="#regressions">Regressions</a>
  <ul>
  <li><a href="#linear-regression" id="toc-linear-regression" class="nav-link" data-scroll-target="#linear-regression">Linear Regression</a></li>
  <li><a href="#lasso-technique" id="toc-lasso-technique" class="nav-link" data-scroll-target="#lasso-technique">LASSO Technique</a>
  <ul class="collapse">
  <li><a href="#background" id="toc-background" class="nav-link" data-scroll-target="#background">Background</a>
  <ul class="collapse">
  <li><a href="#the-core-mechanism" id="toc-the-core-mechanism" class="nav-link" data-scroll-target="#the-core-mechanism">The Core Mechanism</a></li>
  <li><a href="#why-data-scientists-love-lasso" id="toc-why-data-scientists-love-lasso" class="nav-link" data-scroll-target="#why-data-scientists-love-lasso">Why Data Scientists Love LASSO</a></li>
  <li><a href="#practical-implementation" id="toc-practical-implementation" class="nav-link" data-scroll-target="#practical-implementation">Practical Implementation</a></li>
  </ul></li>
  <li><a href="#modeling" id="toc-modeling" class="nav-link" data-scroll-target="#modeling">Modeling</a>
  <ul class="collapse">
  <li><a href="#prepare-your-feature-matrix---glmnet-requires-matrix-format" id="toc-prepare-your-feature-matrix---glmnet-requires-matrix-format" class="nav-link" data-scroll-target="#prepare-your-feature-matrix---glmnet-requires-matrix-format">Prepare your feature matrix - glmnet requires matrix format</a></li>
  <li><a href="#extract-target-variable" id="toc-extract-target-variable" class="nav-link" data-scroll-target="#extract-target-variable">Extract target variable</a></li>
  <li><a href="#fit-lasso-regression-across-lambda-values" id="toc-fit-lasso-regression-across-lambda-values" class="nav-link" data-scroll-target="#fit-lasso-regression-across-lambda-values">Fit LASSO regression across lambda values</a></li>
  <li><a href="#use-cross-validation-to-find-optimal-lambda" id="toc-use-cross-validation-to-find-optimal-lambda" class="nav-link" data-scroll-target="#use-cross-validation-to-find-optimal-lambda">Use cross-validation to find optimal lambda</a></li>
  <li><a href="#plot-cross-validation-results" id="toc-plot-cross-validation-results" class="nav-link" data-scroll-target="#plot-cross-validation-results">Plot cross-validation results</a></li>
  <li><a href="#extract-optimal-lambda-values" id="toc-extract-optimal-lambda-values" class="nav-link" data-scroll-target="#extract-optimal-lambda-values">Extract optimal lambda values</a></li>
  <li><a href="#fit-final-model-with-optimal-lambda" id="toc-fit-final-model-with-optimal-lambda" class="nav-link" data-scroll-target="#fit-final-model-with-optimal-lambda">Fit final model with optimal lambda</a></li>
  <li><a href="#view-selected-features-non-zero-coefficients" id="toc-view-selected-features-non-zero-coefficients" class="nav-link" data-scroll-target="#view-selected-features-non-zero-coefficients">View selected features (non-zero coefficients)</a></li>
  <li><a href="#compare-number-of-features-original-vs-lasso-selected" id="toc-compare-number-of-features-original-vs-lasso-selected" class="nav-link" data-scroll-target="#compare-number-of-features-original-vs-lasso-selected">Compare number of features: original vs LASSO-selected</a></li>
  </ul></li>
  <li><a href="#model-performance-metrics" id="toc-model-performance-metrics" class="nav-link" data-scroll-target="#model-performance-metrics">Model Performance Metrics</a>
  <ul class="collapse">
  <li><a href="#essential-performance-metrics" id="toc-essential-performance-metrics" class="nav-link" data-scroll-target="#essential-performance-metrics">Essential Performance Metrics</a></li>
  <li><a href="#cross-validation-performance" id="toc-cross-validation-performance" class="nav-link" data-scroll-target="#cross-validation-performance">Cross-Validation Performance</a></li>
  <li><a href="#baseline-comparison" id="toc-baseline-comparison" class="nav-link" data-scroll-target="#baseline-comparison">Baseline Comparison</a></li>
  <li><a href="#prediction-quality-insights" id="toc-prediction-quality-insights" class="nav-link" data-scroll-target="#prediction-quality-insights">Prediction Quality Insights</a></li>
  </ul></li>
  <li><a href="#summary-of-model-performance" id="toc-summary-of-model-performance" class="nav-link" data-scroll-target="#summary-of-model-performance">Summary of Model Performance</a>
  <ul class="collapse">
  <li><a href="#strong-overall-performance" id="toc-strong-overall-performance" class="nav-link" data-scroll-target="#strong-overall-performance">Strong Overall Performance:</a></li>
  <li><a href="#cross-validation-results-the-gold-standard" id="toc-cross-validation-results-the-gold-standard" class="nav-link" data-scroll-target="#cross-validation-results-the-gold-standard">Cross-Validation Results (The Gold Standard)</a></li>
  <li><a href="#visual-diagnostics-look-great" id="toc-visual-diagnostics-look-great" class="nav-link" data-scroll-target="#visual-diagnostics-look-great">Visual Diagnostics Look Great</a></li>
  <li><a href="#data-science-perspective" id="toc-data-science-perspective" class="nav-link" data-scroll-target="#data-science-perspective">Data Science Perspective</a></li>
  <li><a href="#model-deployment-readiness" id="toc-model-deployment-readiness" class="nav-link" data-scroll-target="#model-deployment-readiness">Model Deployment Readiness</a></li>
  </ul></li>
  </ul></li>
  </ul></li>
  </ul>
</nav>
</div>
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">LASSO Regressions Quarto</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<style type="text/css">
.main-container {
  max-width: 1400px;
  margin-left: auto;
  margin-right: auto;
}

/* Better table formatting */
.table {
  font-size: 0.9em;
  margin: 1em 0;
}

.table th, .table td {
  padding: 0.5em;
  text-align: left;
}

/* Coefficient table styling */
.coef-table {
  font-size: 0.95em;
  font-family: monospace;
}

/* Better code output - smaller font to fit width */
pre {
  font-size: 0.90em;
  max-width: 100%;
  overflow-x: auto;
}

/* Regression output - smaller font to fit better */
.cell-output pre {
  font-size: .85em;
  white-space: pre;
  overflow-x: auto;
}

/* Force kable tables to respect column widths */
.kable-table {
  width: auto !important;
  max-width: 500px !important;
  table-layout: fixed !important;
}

.kable-table th:first-child,
.kable-table td:first-child {
  width: 300px !important;
  max-width: 300px !important;
  word-wrap: break-word;
}

.kable-table th:last-child,
.kable-table td:last-child {
  width: 100px !important;
  max-width: 100px !important;
  text-align: right;
}
</style>
<section id="packages" class="level1">
<h1>Packages</h1>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Data Manipulation</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse) <span class="co"># Basic data manipulation function</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(janitor) <span class="co"># Advanced data manipulation function</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Graphing and Analysis</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(glmnet)</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Quarto</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(kableExtra)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="data" class="level1">
<h1>Data</h1>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(flight_data8)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 8,477
Columns: 10
$ Airline                &lt;chr&gt; "IndiGo", "IndiGo", "SpiceJet", "Jet Airways", …
$ number_of_stops        &lt;dbl&gt; 1, 1, 0, 1, 1, 1, 1, 0, 0, 2, 1, 1, 2, 1, 1, 0,…
$ airport_code_departure &lt;chr&gt; "CCU", "BLR", "CCU", "BLR", "BLR", "DEL", "DEL"…
$ airport_code_arrival   &lt;chr&gt; "BLR", "DEL", "BLR", "DEL", "DEL", "COK", "COK"…
$ Departure_Day          &lt;dbl&gt; 12, 1, 24, 12, 1, 27, 1, 18, 24, 3, 15, 12, 12,…
$ Departure_Month        &lt;dbl&gt; 5, 3, 6, 3, 3, 5, 6, 4, 6, 3, 4, 6, 6, 5, 3, 4,…
$ Departure_Hour         &lt;dbl&gt; 18, 16, 9, 18, 8, 11, 9, 20, 11, 16, 8, 14, 20,…
$ Duration_Hours         &lt;dbl&gt; 5.416667, 4.750000, 2.416667, 15.500000, 21.083…
$ weekend                &lt;chr&gt; "Weekend", "Weekday", "Weekday", "Weekday", "We…
$ Price                  &lt;dbl&gt; 6218, 13302, 3873, 11087, 22270, 8625, 8907, 41…</code></pre>
</div>
</div>
</section>
<section id="regressions" class="level1">
<h1>Regressions</h1>
<section id="linear-regression" class="level2">
<h2 class="anchored" data-anchor-id="linear-regression">Linear Regression</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>regression.flight <span class="ot">&lt;-</span> <span class="fu">lm</span>(Price <span class="sc">~</span> Departure_Day <span class="sc">+</span> Departure_Month <span class="sc">+</span> Departure_Hour <span class="sc">+</span> Duration_Hours <span class="sc">+</span> </span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>                          number_of_stops <span class="sc">+</span> weekend <span class="sc">+</span> </span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>                          Airline <span class="sc">+</span> airport_code_departure <span class="sc">+</span> airport_code_arrival,</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>                          <span class="at">data =</span> flight_data8)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = Price ~ Departure_Day + Departure_Month + Departure_Hour + 
    Duration_Hours + number_of_stops + weekend + Airline + airport_code_departure + 
    airport_code_arrival, data = flight_data8)

Residuals:
   Min     1Q Median     3Q    Max 
-13988  -1507   -201   1337  40797 

Coefficients: (4 not defined because of singularities)
                                          Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)                               8208.221    241.435  33.998  &lt; 2e-16 ***
Departure_Day                              -80.319      3.702 -21.699  &lt; 2e-16 ***
Departure_Month                           -635.555     27.757 -22.897  &lt; 2e-16 ***
Departure_Hour                              18.969      5.547   3.420 0.000630 ***
Duration_Hours                              11.507      5.903   1.949 0.051293 .  
number_of_stops                           3010.817     80.711  37.304  &lt; 2e-16 ***
weekendWeekend                             260.809     68.045   3.833 0.000128 ***
AirlineAir India                          1587.642    202.108   7.855 4.47e-15 ***
AirlineGoAir                               -47.842    290.473  -0.165 0.869182    
AirlineIndiGo                              293.817    193.687   1.517 0.129312    
AirlineJet Airways                        4422.949    191.127  23.141  &lt; 2e-16 ***
AirlineJet Airways Business              48015.158   1176.098  40.826  &lt; 2e-16 ***
AirlineMultiple carriers                  3778.746    208.811  18.096  &lt; 2e-16 ***
AirlineMultiple carriers Premium economy  3956.566    878.159   4.506 6.71e-06 ***
AirlineSpiceJet                           -244.574    213.326  -1.146 0.251629    
AirlineTrujet                            -3206.122   2846.401  -1.126 0.260038    
AirlineVistara                            2000.639    233.336   8.574  &lt; 2e-16 ***
AirlineVistara Premium economy            2710.605   2015.204   1.345 0.178636    
airport_code_departureBOM                -1768.329    139.967 -12.634  &lt; 2e-16 ***
airport_code_departureCCU                 -356.941    101.396  -3.520 0.000433 ***
airport_code_departureDEL                 -355.210    109.994  -3.229 0.001245 ** 
airport_code_departureMAA                   11.020    183.499   0.060 0.952113    
airport_code_arrivalCCU                         NA         NA      NA       NA    
airport_code_arrivalCOK                         NA         NA      NA       NA    
airport_code_arrivalDEL                         NA         NA      NA       NA    
airport_code_arrivalHYD                         NA         NA      NA       NA    
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 2836 on 8455 degrees of freedom
Multiple R-squared:  0.6289,    Adjusted R-squared:  0.6279 
F-statistic: 682.2 on 21 and 8455 DF,  p-value: &lt; 2.2e-16</code></pre>
</div>
</div>
</section>
<section id="lasso-technique" class="level2">
<h2 class="anchored" data-anchor-id="lasso-technique">LASSO Technique</h2>
<section id="background" class="level3">
<h3 class="anchored" data-anchor-id="background">Background</h3>
<p>LASSO is a <strong>regularization technique</strong> that extends ordinary least squares regression by adding a penalty term to prevent overfitting and perform automatic <strong>feature selection</strong>. Here’s how it works:</p>
<section id="the-core-mechanism" class="level4">
<h4 class="anchored" data-anchor-id="the-core-mechanism">The Core Mechanism</h4>
<p>In regular linear regression, we minimize the sum of squared errors. LASSO adds an L1 penalty term:</p>
<p><strong>LASSO objective function:</strong> Minimize [RSS + λ∑|βⱼ|]</p>
<p>Where λ (lambda) is the <strong>regularization parameter</strong> (or hyperparameter) that controls the strength of the penalty. The key insight is that the L1 penalty (absolute values of coefficients) forces some coefficients to exactly zero, effectively removing those features from the model.</p>
</section>
<section id="why-data-scientists-love-lasso" class="level4">
<h4 class="anchored" data-anchor-id="why-data-scientists-love-lasso">Why Data Scientists Love LASSO</h4>
<ol type="1">
<li><p><strong>Automatic Feature Selection</strong>: Unlike traditional stepwise regression you might be familiar with, LASSO simultaneously fits the model and selects features. This is crucial in high-dimensional data where you might have hundreds or thousands of features.</p></li>
<li><p><strong>Handles Multicollinearity</strong>: When features are highly correlated, LASSO tends to pick one from a group and zero out the others, creating a more interpretable model.</p></li>
<li><p><strong>Prevents Overfitting</strong>: The regularization shrinks coefficients toward zero, reducing model complexity.</p></li>
</ol>
</section>
<section id="practical-implementation" class="level4">
<h4 class="anchored" data-anchor-id="practical-implementation">Practical Implementation</h4>
<p>The λ parameter is typically chosen through <strong>cross-validation</strong> - you’d fit LASSO models across a range of λ values and select the one that minimizes prediction error on held-out data. This process is called <strong>hyperparameter tuning</strong>.</p>
<p>In your education research context, imagine predicting student outcomes using dozens of demographic, behavioral, and academic features. LASSO would help you identify which features actually matter while creating a model that generalizes well to new students.</p>
</section>
</section>
<section id="modeling" class="level3">
<h3 class="anchored" data-anchor-id="modeling">Modeling</h3>
<section id="prepare-your-feature-matrix---glmnet-requires-matrix-format" class="level4">
<h4 class="anchored" data-anchor-id="prepare-your-feature-matrix---glmnet-requires-matrix-format">Prepare your feature matrix - glmnet requires matrix format</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>X <span class="ot">&lt;-</span> <span class="fu">model.matrix</span>(Price <span class="sc">~</span> Departure_Day <span class="sc">+</span> Departure_Month <span class="sc">+</span> Departure_Hour <span class="sc">+</span> Duration_Hours <span class="sc">+</span> number_of_stops <span class="sc">+</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>                    weekend <span class="sc">+</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>                    Airline <span class="sc">+</span> airport_code_arrival <span class="sc">-</span> <span class="dv">1</span>, </span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>                  <span class="at">data =</span> flight_data8)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="extract-target-variable" class="level4">
<h4 class="anchored" data-anchor-id="extract-target-variable">Extract target variable</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> flight_data8<span class="sc">$</span>Price</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="fit-lasso-regression-across-lambda-values" class="level4">
<h4 class="anchored" data-anchor-id="fit-lasso-regression-across-lambda-values">Fit LASSO regression across lambda values</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>lasso_flight <span class="ot">&lt;-</span> <span class="fu">glmnet</span>(X, y, <span class="at">alpha =</span> <span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="use-cross-validation-to-find-optimal-lambda" class="level4">
<h4 class="anchored" data-anchor-id="use-cross-validation-to-find-optimal-lambda">Use cross-validation to find optimal lambda</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>cv_lasso_flight <span class="ot">&lt;-</span> <span class="fu">cv.glmnet</span>(X, y, <span class="at">alpha =</span> <span class="dv">1</span>, <span class="at">nfolds =</span> <span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="plot-cross-validation-results" class="level4">
<h4 class="anchored" data-anchor-id="plot-cross-validation-results">Plot cross-validation results</h4>
<p><strong>Reading Your CV Plot</strong></p>
<p>The two vertical dashed lines are crucial:</p>
<ul>
<li><p>Left line (lambda.min): The λ value that minimizes cross-validation error - gives you the best predictive performance</p></li>
<li><p>Right line (lambda.1se): A more conservative choice - the largest λ within one standard error of the minimum. This is the <em>“one standard error rule”</em></p></li>
</ul>
<p><strong>The numbers at the top (0, 1, 2, 3, etc.)</strong> show how many features remain in the model at each λ value. Notice how:</p>
<ul>
<li><p>Far left: All ~21 features are included (minimal regularization)</p></li>
<li><p>Far right: Only a few features survive the heavy regularization</p></li>
<li><p>Your optimal models (between the lines) use roughly 15-21 features</p></li>
</ul>
<p><strong>Key Takeaway for Your Flight Price Model</strong></p>
<p>Your CV curve shows a classic pattern - error decreases as you add regularization (moving right), reaches a minimum, then starts increasing again as you over-regularize. The relatively flat bottom suggests your model is robust across a range of λ values.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(cv_lasso_flight)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="LASSO-Regressions-Quarto_files/figure-html/unnamed-chunk-10-1.png" class="img-fluid figure-img" width="768"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="extract-optimal-lambda-values" class="level4">
<h4 class="anchored" data-anchor-id="extract-optimal-lambda-values">Extract optimal lambda values</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>lambda_min <span class="ot">&lt;-</span> cv_lasso_flight<span class="sc">$</span>lambda.min      </span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>lambda_1se <span class="ot">&lt;-</span> cv_lasso_flight<span class="sc">$</span>lambda<span class="fl">.1</span>se  </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="fit-final-model-with-optimal-lambda" class="level4">
<h4 class="anchored" data-anchor-id="fit-final-model-with-optimal-lambda">Fit final model with optimal lambda</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>final_flight_model <span class="ot">&lt;-</span> <span class="fu">glmnet</span>(X, y, <span class="at">alpha =</span> <span class="dv">1</span>, <span class="at">lambda =</span> lambda_min)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="view-selected-features-non-zero-coefficients" class="level4">
<h4 class="anchored" data-anchor-id="view-selected-features-non-zero-coefficients">View selected features (non-zero coefficients)</h4>
<p><strong>LASSO Results Analysis</strong> Your model selected 20 meaningful features out of the original set:</p>
<p>Most important price drivers:</p>
<ul>
<li><p>Jet Airways Business (+47,520!) and number of stops (+3,007)</p></li>
<li><p>Seasonal effects: Departure month (-632) suggests cheaper flights later in year</p></li>
<li><p>Carrier effects: Clear premium hierarchy (Jet Airways Business &gt;&gt; Vistara &gt;&gt; Air India &gt;&gt; budget carriers)</p></li>
<li><p>Route effects: HYD arrival is cheaper (-1,391) than CCU/DEL</p></li>
</ul>
<div class="cell">
<div class="cell-output-display">
<div class="table-responsive">
<table class="table table-striped table-hover table-condensed caption-top table-sm small" data-quarto-postprocess="true">
<caption>LASSO Selected Features and Coefficients</caption>
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th" style="text-align: left; position: sticky; top: 0; background-color: #FFFFFF; font-weight: bold; background-color: rgba(248, 249, 250, 255) !important;">Feature</th>
<th data-quarto-table-cell-role="th" style="text-align: right; position: sticky; top: 0; background-color: #FFFFFF; font-weight: bold; background-color: rgba(248, 249, 250, 255) !important;">Coefficient</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left; width: 200px;">(Intercept)</td>
<td style="text-align: right; width: 100px; font-weight: bold;">8382.06</td>
</tr>
<tr class="even">
<td style="text-align: left; width: 200px;">Departure_Day:</td>
<td style="text-align: right; width: 100px; font-weight: bold;">-79.85</td>
</tr>
<tr class="odd">
<td style="text-align: left; width: 200px;">Departure_Month:</td>
<td style="text-align: right; width: 100px; font-weight: bold;">-632.40</td>
</tr>
<tr class="even">
<td style="text-align: left; width: 200px;">Departure_Hour:</td>
<td style="text-align: right; width: 100px; font-weight: bold;">17.47</td>
</tr>
<tr class="odd">
<td style="text-align: left; width: 200px;">Duration_Hours:</td>
<td style="text-align: right; width: 100px; font-weight: bold;">11.70</td>
</tr>
<tr class="even">
<td style="text-align: left; width: 200px;">number_of_stops:</td>
<td style="text-align: right; width: 100px; font-weight: bold;">3008.69</td>
</tr>
<tr class="odd">
<td style="text-align: left; width: 200px;">weekendWeekday:</td>
<td style="text-align: right; width: 100px; font-weight: bold;">-248.88</td>
</tr>
<tr class="even">
<td style="text-align: left; width: 200px;">weekendWeekend:</td>
<td style="text-align: right; width: 100px; font-weight: bold;">0.00</td>
</tr>
<tr class="odd">
<td style="text-align: left; width: 200px;">AirlineAir: India</td>
<td style="text-align: right; width: 100px; font-weight: bold;">1296.77</td>
</tr>
<tr class="even">
<td style="text-align: left; width: 200px;">AirlineGoAir:</td>
<td style="text-align: right; width: 100px; font-weight: bold;">-285.24</td>
</tr>
<tr class="odd">
<td style="text-align: left; width: 200px;">AirlineIndiGo:</td>
<td style="text-align: right; width: 100px; font-weight: bold;">7.05</td>
</tr>
<tr class="even">
<td style="text-align: left; width: 200px;">AirlineJet: Airways</td>
<td style="text-align: right; width: 100px; font-weight: bold;">4138.42</td>
</tr>
<tr class="odd">
<td style="text-align: left; width: 200px;">AirlineJet: Airways Business</td>
<td style="text-align: right; width: 100px; font-weight: bold;">47564.74</td>
</tr>
<tr class="even">
<td style="text-align: left; width: 200px;">AirlineMultiple: carriers</td>
<td style="text-align: right; width: 100px; font-weight: bold;">3481.17</td>
</tr>
<tr class="odd">
<td style="text-align: left; width: 200px;">AirlineMultiple: carriers Premium economy</td>
<td style="text-align: right; width: 100px; font-weight: bold;">3527.75</td>
</tr>
<tr class="even">
<td style="text-align: left; width: 200px;">AirlineSpiceJet:</td>
<td style="text-align: right; width: 100px; font-weight: bold;">-503.49</td>
</tr>
<tr class="odd">
<td style="text-align: left; width: 200px;">AirlineTrujet:</td>
<td style="text-align: right; width: 100px; font-weight: bold;">-3034.78</td>
</tr>
<tr class="even">
<td style="text-align: left; width: 200px;">AirlineVistara:</td>
<td style="text-align: right; width: 100px; font-weight: bold;">1706.19</td>
</tr>
<tr class="odd">
<td style="text-align: left; width: 200px;">AirlineVistara: Premium economy</td>
<td style="text-align: right; width: 100px; font-weight: bold;">2136.62</td>
</tr>
<tr class="even">
<td style="text-align: left; width: 200px;">airport_code_arrivalCCU:</td>
<td style="text-align: right; width: 100px; font-weight: bold;">338.28</td>
</tr>
<tr class="odd">
<td style="text-align: left; width: 200px;">airport_code_arrivalDEL:</td>
<td style="text-align: right; width: 100px; font-weight: bold;">339.34</td>
</tr>
<tr class="even">
<td style="text-align: left; width: 200px;">airport_code_arrivalHYD:</td>
<td style="text-align: right; width: 100px; font-weight: bold;">-1392.94</td>
</tr>
</tbody>
</table>
</div>


</div>
</div>
</section>
<section id="compare-number-of-features-original-vs-lasso-selected" class="level4">
<h4 class="anchored" data-anchor-id="compare-number-of-features-original-vs-lasso-selected">Compare number of features: original vs LASSO-selected</h4>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>Original model features: 22 </code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>LASSO selected features: 21 </code></pre>
</div>
</div>
</section>
</section>
<section id="model-performance-metrics" class="level3">
<h3 class="anchored" data-anchor-id="model-performance-metrics">Model Performance Metrics</h3>
<section id="essential-performance-metrics" class="level4">
<h4 class="anchored" data-anchor-id="essential-performance-metrics">Essential Performance Metrics</h4>
<section id="make-predictions-on-your-data" class="level5">
<h5 class="anchored" data-anchor-id="make-predictions-on-your-data">Make predictions on your data</h5>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>lasso_predictions <span class="ot">&lt;-</span> <span class="fu">predict</span>(final_flight_model, <span class="at">newx =</span> X)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="calculate-core-regression-metrics" class="level5">
<h5 class="anchored" data-anchor-id="calculate-core-regression-metrics">Calculate core regression metrics</h5>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>rmse_lasso <span class="ot">&lt;-</span> <span class="fu">sqrt</span>(<span class="fu">mean</span>((y <span class="sc">-</span> lasso_predictions)<span class="sc">^</span><span class="dv">2</span>))</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>mae_lasso <span class="ot">&lt;-</span> <span class="fu">mean</span>(<span class="fu">abs</span>(y <span class="sc">-</span> lasso_predictions))</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>r_squared_lasso <span class="ot">&lt;-</span> <span class="fu">cor</span>(y, lasso_predictions)<span class="sc">^</span><span class="dv">2</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="results" class="level5">
<h5 class="anchored" data-anchor-id="results">Results</h5>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>LASSO Performance Metrics:</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>RMSE (Root Mean Squared Error): 2833.2 </code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>MAE (Mean Absolute Error): 1973.27 </code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>R-squared: 0.6287 </code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Mean flight price: 9099.84 </code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>RMSE as % of mean price: 31.1 %</code></pre>
</div>
</div>
</section>
</section>
<section id="cross-validation-performance" class="level4">
<h4 class="anchored" data-anchor-id="cross-validation-performance">Cross-Validation Performance</h4>
<section id="get-cv-performance-at-optimal-lambda" class="level5">
<h5 class="anchored" data-anchor-id="get-cv-performance-at-optimal-lambda">Get CV performance at optimal lambda</h5>
<div class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>cv_rmse <span class="ot">&lt;-</span> <span class="fu">sqrt</span>(cv_lasso_flight<span class="sc">$</span>cvm[cv_lasso_flight<span class="sc">$</span>lambda <span class="sc">==</span> lambda_min])</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>cv_rmse_1se <span class="ot">&lt;-</span> <span class="fu">sqrt</span>(cv_lasso_flight<span class="sc">$</span>cvm[cv_lasso_flight<span class="sc">$</span>lambda <span class="sc">==</span> lambda_1se])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>
Cross-Validation Performance:</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>CV RMSE at lambda.min: 2846.66 </code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>CV RMSE at lambda.1se: 2901.04 </code></pre>
</div>
</div>
</section>
</section>
<section id="baseline-comparison" class="level4">
<h4 class="anchored" data-anchor-id="baseline-comparison">Baseline Comparison</h4>
<section id="simple-baseline-predict-mean-price-for-everything" class="level5">
<h5 class="anchored" data-anchor-id="simple-baseline-predict-mean-price-for-everything">Simple baseline: predict mean price for everything</h5>
<div class="cell">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>baseline_rmse <span class="ot">&lt;-</span> <span class="fu">sqrt</span>(<span class="fu">mean</span>((y <span class="sc">-</span> <span class="fu">mean</span>(y))<span class="sc">^</span><span class="dv">2</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="improvement-over-baseline" class="level5">
<h5 class="anchored" data-anchor-id="improvement-over-baseline">Improvement over baseline</h5>
<div class="cell">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>improvement <span class="ot">&lt;-</span> (baseline_rmse <span class="sc">-</span> rmse_lasso) <span class="sc">/</span> baseline_rmse <span class="sc">*</span> <span class="dv">100</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>
Model Comparison:</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Baseline RMSE (predicting mean): 4649.78 </code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>LASSO improvement over baseline: 39.1 %</code></pre>
</div>
</div>
</section>
</section>
<section id="prediction-quality-insights" class="level4">
<h4 class="anchored" data-anchor-id="prediction-quality-insights">Prediction Quality Insights</h4>
<section id="look-at-prediction-vs-actual-scatter" class="level5">
<h5 class="anchored" data-anchor-id="look-at-prediction-vs-actual-scatter">Look at prediction vs actual scatter</h5>
<div class="cell">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(lasso_predictions, y, </span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlab =</span> <span class="st">"Predicted Price"</span>, <span class="at">ylab =</span> <span class="st">"Actual Price"</span>,</span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a>     <span class="at">main =</span> <span class="st">"LASSO: Predicted vs Actual Flight Prices"</span>)</span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="at">col =</span> <span class="st">"red"</span>, <span class="at">lty =</span> <span class="dv">2</span>)  <span class="co"># Perfect prediction line</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="LASSO-Regressions-Quarto_files/figure-html/unnamed-chunk-23-1.png" class="img-fluid figure-img" width="768"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="residual-analysis" class="level5">
<h5 class="anchored" data-anchor-id="residual-analysis">Residual Analysis</h5>
<div class="cell">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>residuals <span class="ot">&lt;-</span> y <span class="sc">-</span> lasso_predictions</span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(lasso_predictions, residuals,</span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlab =</span> <span class="st">"Predicted Price"</span>, <span class="at">ylab =</span> <span class="st">"Residuals"</span>,</span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a>     <span class="at">main =</span> <span class="st">"Residual Plot - Check for Patterns"</span>)</span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">h =</span> <span class="dv">0</span>, <span class="at">col =</span> <span class="st">"red"</span>, <span class="at">lty =</span> <span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="LASSO-Regressions-Quarto_files/figure-html/unnamed-chunk-24-1.png" class="img-fluid figure-img" width="768"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
</section>
<section id="summary-of-model-performance" class="level3">
<h3 class="anchored" data-anchor-id="summary-of-model-performance">Summary of Model Performance</h3>
<section id="strong-overall-performance" class="level4">
<h4 class="anchored" data-anchor-id="strong-overall-performance">Strong Overall Performance:</h4>
<ul>
<li><p><strong>RMSE: ₹2,833</strong> - Typical prediction error is about ₹2,833, which is quite reasonable for flight prices</p></li>
<li><p><strong>31.1% RMSE relative to mean price</strong> - This is actually good performance for pricing models, especially in a volatile market like flights</p></li>
<li><p><strong>39.1% improvement over baseline</strong> - This is substantial! Capturing real economic patterns, not just noise</p></li>
</ul>
</section>
<section id="cross-validation-results-the-gold-standard" class="level4">
<h4 class="anchored" data-anchor-id="cross-validation-results-the-gold-standard">Cross-Validation Results (The Gold Standard)</h4>
<p><strong>CV RMSE of ₹2,851</strong> is very close to your training RMSE (₹2,833), which indicates:</p>
<ul>
<li><p><strong>No overfitting</strong> - Critical for deployment to new data</p></li>
<li><p><strong>Robust model</strong> - Performance will generalize well</p></li>
<li><p><strong>Proper regularization</strong> - LASSO successfully balanced bias-variance tradeoff</p></li>
</ul>
</section>
<section id="visual-diagnostics-look-great" class="level4">
<h4 class="anchored" data-anchor-id="visual-diagnostics-look-great">Visual Diagnostics Look Great</h4>
<p><strong>Predicted vs Actual plot:</strong> Shows good <strong>heteroscedasticity</strong> (spread increases with price) - this is normal for pricing data where expensive items have more variation.</p>
<p><strong>Residual plot:</strong> The random scatter around zero with no clear patterns suggests your model has captured the main relationships. A few <strong>outliers</strong> in the high-price range are expected (probably those Jet Airways Business class flights).</p>
</section>
<section id="data-science-perspective" class="level4">
<h4 class="anchored" data-anchor-id="data-science-perspective">Data Science Perspective</h4>
<p>Your <strong>R² of 0.63</strong> might seem moderate compared to controlled experiments, but for real-world pricing prediction with many unobserved factors (seat availability, competitor pricing, demand), this represents solid <strong>predictive power</strong>.</p>
</section>
<section id="model-deployment-readiness" class="level4">
<h4 class="anchored" data-anchor-id="model-deployment-readiness">Model Deployment Readiness</h4>
<p>The close agreement between training and CV performance suggests this model would perform well in production for flight price estimation. The key business insight - that airline type and number of stops are the strongest price drivers - aligns with industry knowledge.</p>
</section>
</section>
</section>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>